<!--<link rel="import" href="/components/polymer/polymer-element.html">-->
<!--<link rel="import" href="/components/iron-ajax/iron-ajax.html">-->
<!--&lt;!&ndash;<link rel="import" href="bower_components/vaadin-valo-theme/vaadin-combo-box.html">&ndash;&gt;-->
<!--<link rel="import" href="/components/vaadin-material-theme/vaadin-text-field.html">-->
<!--<link rel="import" href="/components/vaadin-combo-box/vaadin-combo-box.html">-->

<dom-module id="af-branches">
    <template>
        <style>
            :host { display: block; }
        </style>
        <!-- 1. get list of sections http://localhost/af/wiki/api.php?format=json&action=parse&prop=sections&page=Sources:ApiFusion.org/Sources/git-restful -->
        <iron-ajax url="[[wgScriptPath]]/api.php?format=json&action=parse&prop=sections&page=Sources:[[wgPageName]]"
                   last-response="{{srcSections}}"
                   on-response="handleSrcResponse"
                   auto
                ></iron-ajax>
        <iron-ajax url="[[wgScriptPath]]/api.php?format=json&action=parse&prop=sections&page=Sources:[[wgPageName]]"
                   last-response="{{impSections}}"
                   on-response="handleImpResponse"
                   auto
                ></iron-ajax>

        <!-- 2. get section by # http://localhost/af/wiki/api.php?format=json&action=parse&prop=wikitext&&section=1&page=Sources:ApiFusion.org/Sources/git-restful -->
        <iron-ajax url="[[wgScriptPath]]/api.php?format=json&action=parse&prop=wikitext&section=[[srcSectionNum]]&page=Sources:[[wgPageName]]"          on-response="onSrcSection" auto></iron-ajax>
        <iron-ajax url="[[wgScriptPath]]/api.php?format=json&action=parse&prop=wikitext&section=[[impSectionNum]]&page=Implementation:[[wgPageName]]"   on-response="onImpSection" auto></iron-ajax>

        <vaadin-combo-box label="Branch" items="[[srcSections.parse.sections]]" item-value-path="line" item-label-path="line"></vaadin-combo-box>
        [[srcSection]]
        <hr/>
        [[impSection]]
    </template>

    <script>
        // http://localhost/af/wiki/api.php?action=parse&prop=sections&page=Sources:ApiFusion.org/Sources/git-restful/src/main/java/org/apifusion/git_restful
        define('af-branches',   [   "link-import!polymer/polymer-element.html"
                                ,   "link-import!iron-ajax/iron-ajax.html"
                                ,   "link-import!vaadin-material-theme/vaadin-text-field.html" //,   "link-import!vaadin-valo-theme/vaadin-combo-box.html"
                                ,   "link-import!vaadin-combo-box/vaadin-combo-box.html"
                                ],()=>
        {

/**
 * `af-branches`
 * Version control Branches selector out of Implementation namespace headers of ApiFusion git source import mediawiki page
 *
 * @customElement
 * @polymer
 * @demo demo/index.html
 */
class AfBranches extends Polymer.Element
{
    static get is() { return 'af-branches'; }
    static get properties()
    {
        return  {   /** {{PAGENAME}} mediawiki page (title)             */ wgPageName  : {   type: String, value: window.wgPageName   }
                ,   /** {{SCRIPTPATH}} path to mediawiki to get API url */ wgScriptPath: {   type: String, value: window.wgScriptPath }
                ,   /** selected branch to show/compare against         */ branch:
                    {   type: String
                    ,   reflectToAttribute: true
                    ,   notify: true
                    ,   value: 'master'
                    }
                };
    }
    onSrcSection( data ){   this.srcSection = data.detail.response.parse.wikitext['*'] }
    onImpSection( data ){   this.impSection = data.detail.response.parse.wikitext['*'] }
    handleSrcResponse( data ){   this.srcSectionNum = this.s2i( data ) }
    handleImpResponse( data ){   this.impSectionNum = this.s2i( data ) }
    s2i( data ){ return data.detail.response.parse.sections.find( el => el.line === this.branch ).number }
}

            window.customElements.define( AfBranches.is, AfBranches );
            return AfBranches;
        });
        require(['af-branches'], function( m )
        {
            console.log(m)
        });
    </script>
</dom-module>
